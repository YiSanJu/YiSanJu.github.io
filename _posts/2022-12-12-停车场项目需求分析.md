---
layout:     post
title:      停车场项目需求分析
subtitle:   停车场项目需求分析
date:       2022-12-12
author:     Sanju
header-img: img/picture-posts/posts-skins/d.jpg
catalog: true
tags:
   - 方案分析
   - 移动端
   - 停车场
---

# 停车场项目需求分析

## 一、背景

​		客户需要公司提供完备的停车场收费服务，目前主要是微信端的开发，包括微信公众号（小程序），便于其用户使用。

## 二、框架选用	

### 		uni-app

​		目前项目需要支持的平台为微信公众号，以及后续可能的需求：各种小程序（微信/支付宝），ios、安卓等，所以选用uni-app框架搭建。

> ​	uni-app 是一个使用 Vue.js (opens new window)开发所有前端应用的框架，开发者编写一套代码，可发布到iOS、Android、Web（响应式）、以及各种小程序（微信/支付宝/百度/头条/飞书/QQ/快手/钉钉/淘宝）、快应用等多个平台。		

### 		微信公众号

​		由于开发周期的限制，目前微信端只开发一个服务号（小程序之后按需开发），实现消息推送以及常见需求的功能，详细见需求分析。

#### 	微信三个平台区别

​		微信三个平台区别

- **微信开放平台**
  	面向开发人员，为网站、App 提供微信第三方登录功能，为 App 提供支付功能（通过客户端 sdk 拉起微信客户端）
- **微信公众平台**
  	对应的是公众号，有三种账号类型，服务号、订阅号和小程序,主要面向运营人员和开发人员，运营可以直接登录公众号管理后台查看公众号的各种指标，开发则是通过调用微信提供的各种接口来增强公众号的功能
- **微信商户平台**
  	用户通过微信支付的钱，最终到达商户账号。无论是开放平台还是公众平台，涉及到支付，都需要商户平台账号

#### 	订阅号与服务号的区别

- **订阅号**
  主要用来发文章，微信的聊天列表中会有“订阅号”这一项，里面全都是订阅号的推送；正常情况下订阅号每天只能群发一条消息
- **服务号**
  	顾名思义，主要是提供服务的，比如银行的服务号，你可以在服务号里面查询一些信息，看一下服务号的菜单大致就了解了服务号提供的哪些服务，服务号在微信聊天列表中是单独的一项，不会像订阅号那样合并起来。服务号其实也可以像订阅号那样群发消息，但是每个自然月只能发 4 次，可以看出是跟订阅号的侧重点完全不同的，两者没有包含被包含的关系，谁也没法取代谁，也不是简单的权限高级低级的区别。



## 三、开发流程

### 	明确功能需求

​		微信公众平台服务号主要提供二种功能：公众号消息会话与公众号内网页

#### 		公众号消息会话（消息推送）

​		根据需求，优先保证群发消息

1. 群发消息

   公众号可以以一定频次（订阅号为每天1次，服务号为每月4次），向用户群发消息

2. 被动回复消息

   在用户给公众号发消息后，微信服务器会将消息发到开发者预先在开发者中心设置的服务器地址（开发者需要进行消息真实性验证），公众号可以在5秒内做出回复，可以回复一个消息，也可以回复命令告诉微信服务器这条消息暂不回复。被动回复消息可以设置加密

3. 客服消息

   用户在公众号内发消息/触发特定行为后，公众号可以给用户发消息。

4. 模板消息

   在需要对用户发送服务通知（如刷卡提醒、服务预约成功通知等）时，公众号可以用特定内容模板，主动向用户发送消息。

#### 		公众号内网页（功能菜单）

​	1.网页授权获取用户基本信息

​		通过该接口，可以获取用户的基本信息（获取用户的 OpenID 是无需用户同意的，获取用户的基本信息则需用户同意）

​	2.微信JS-SDK

​		是开发者在网页上通过 JavaScript 代码使用微信原生功能的工具包，开发者可以使用它在网页上录制和播放微信语音、监听微信分享、上传手机本地图片、拍照等许多能力。

### 	搭建服务号并关联服务器

#### 	申请并搭建服务器

​		已有宇视停车云服务器-----p云------微信支付系统

#### 	申请公众服务号

​		需通过企业资历认证，认证步骤见官网

#### 	开发者基本配置

​		**填写服务器配置**

​			点击“修改配置”按钮，填写服务器地址（URL）、Token和EncodingAESKey

> 其中 URL 是开发者用来接收微信消息和事件的接口URL。Token可由开发者可以任意填写，用作生成签名（该 Token 会和接口 URL 中包含的 Token 进行比对，从而验证安全性）。EncodingAESKey由开发者手动填写或随机生成，将用作消息体加解密密钥。
>
> 同时，开发者可选择消息加解密方式：明文模式、兼容模式和安全模式。模式的选择与服务器配置在提交后都会立即生效，请开发者谨慎填写及选择。加解密方式的默认状态为明文模式，选择兼容模式和安全模式需要提前配置好相关加解密代码

​		**验证服务器地址的有效性**

​			开发者提交信息后，微信服务器将发送 GET 请求到填写的服务器地址 URL 上，开发者通过检验 signature 对请求进行校验，若确认此次 GET 请求来自微信服务器，请原样返回 echostr 参数内容，则接入生效，成为开发者成功，否则接入失败

### **依据接口文档实现业务逻辑**

​		验证 URL 有效性成功后即接入生效，成为开发者。你可以在公众平台网站中申请微信认证，认证成功后，将获得更多接口权限，满足更多业务需求。

​		成为开发者后，用户每次向公众号发送消息、或者产生自定义菜单、或产生微信支付订单等情况时，开发者填写的服务器配置 URL 将得到微信服务器推送过来的消息和事件，开发者可以依据自身业务逻辑进行响应，如回复消息。

### uni-app代码发布H5流程

#### 	打包项目

​		HBuilderX打开你的uni-app项目 -- > 点发行 - > 网站 - PC Web或手机H5

​		填写网站标题和和域名之后点发行

​		编译打包成功后 , 生成unpackage文件夹

#### 	将打包文件夹上传至服务器

​		将文件夹部署至宇视停车云服务器，在服务号的后台页面部署子菜单路径即可

## 四、需求分析与设计

​		根据需求功能规格表，目前开发暂时分为三大菜单：停车缴费、个人中心、关于我们

### 	停车缴费

​		主要提供缴费支付相关的功能，主要流程如下

#### 		场内付款

​		输入车牌号显示支付信息

​			1：输入车牌号，前端调用宇视停车云接口

​			2：宇视停车云接口（采集）获取该车的停车时长、单价/h等，并且调用p云交易预请求接口（返回值包括一个支付链接pay_url与订单id pay_id），拼接成订单详情信息返回给前端

​			3：前端界面获取宇视停车云接口信息，拼接成一个订单详情页面展示给用户

​			4：点击去缴费（属于返回的支付链接）

​			5：p云缴费成功后，将支付结果通知宇视停车云平台(notify_url)，并且跳转至所配置的前端页面（callback_url）

#### 		扫码付款

​		出口扫码跳出订单详情页面（扫码时调用宇视停车云获取车牌号）

#### 		无牌车扫码入场

​		无牌车需扫码入场码进入停车场，出场时需扫码付款 (进入时扫码生成临时车牌号)

### 	个人中心

​		主要提供车主信息相关的功能，主要分为三个模块

#### 	登录模块（Ⅰ）

​		注册/登录

​			使用手机号注册，密码或手机号验证码登录

​			实现：友商使用短信验证码登录，是否可以使用微信登录（暂时使用宇视云账号）

​		个人信息修改

​				昵称、手机号绑定、修改、密码退出登录、注销账号

#### 	显示模块（Ⅱ）

​		车辆信息

​			显示车辆数量；绑定、解绑车辆，选择默认车辆

#### 	功能模块

##### 		停车记录（Ⅰ）

​			支持查询用户停车记录（调用宇视停车云接口查询记录）

### 		关于我们

​			联系我们	

## 三、流程图
![停车场项目架构图](https://yisanju.github.io/img/picture-posts/1.png)
