---
layout: post
title: "Slide文字竖排实现"
subtitle: ""
date: 2026-01-22
author: SanJu
header-img: static/img/tag-bg.jpg
catalog: true
tags:
    - 技术文档
---

<style>
.doc-table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
  font-size: 14px;
}
.doc-table th, .doc-table td {
  border: 1px solid #ddd;
  padding: 10px 12px;
  text-align: left;
}
.doc-table th {
  background-color: #f5f5f5;
  font-weight: 600;
}
.doc-table tr:nth-child(even) {
  background-color: #fafafa;
}
.doc-table tr:hover {
  background-color: #f0f0f0;
}
</style>

Slide文字竖排实现

主要解释了：

- 文字横排竖排的格式解析
- 如何实现竖排渲染效果

# 格式解析

## office表现

1、设置入口如下

![](/static/img/posts/2026-01-22/doc-img-1.png)

- 和腾讯文档的区别：竖排时占排：二个数字 🟰 一个中文字符

![](/static/img/posts/2026-01-22/doc-img-2.png)

### OOXML格式

默认显示横排，vert="eaVert"（强制竖排）。

横排竖排对比

<table class="doc-table"><tr><td><p><strong>属性/节点</strong></p></td><td><p><strong>当前代码（横排）</strong></p></td><td><p><strong>竖排版本（前一示例）</strong></p></td></tr><tr><td><p>&lt;a:bodyPr&gt;</p></td><td><p>无vert（默认horz）</p></td><td><p>vert="eaVert"（强制竖排）</p></td></tr><tr><td><p>文本方向</p></td><td><p>水平排列</p></td><td><p>从上到下竖排</p></td></tr><tr><td><p>自动换行</p></td><td><p>相同（wrap="square"）</p></td><td><p>相同</p></td></tr><tr><td><p>语言标记</p></td><td><p>相同（中英文支持）</p></td><td><p>相同</p></td></tr></table>

文本垂直排版方式枚举

<table class="doc-table"><tr><td><p><strong>枚举值</strong></p></td><td><p><strong>值</strong></p></td><td><p><strong>含义</strong></p></td></tr><tr><td><p>PBDEFAULT</p></td><td><p>0</p></td><td><p><strong>默认值</strong>（视上下文决定水平或垂直）</p></td></tr><tr><td><p>horz</p></td><td><p>1</p></td><td><p><strong>标准水平</strong>（从左到右，多行从上到下）</p></td></tr><tr><td><p>vert</p></td><td><p>2</p></td><td><p><strong>标准垂直</strong>（从上到下，多行从右到左）</p></td></tr><tr><td><p>vert270</p></td><td><p>3</p></td><td><p><strong>270° 旋转垂直</strong>（从上到下，多行从左到右）</p></td></tr><tr><td><p>wordArtVert</p></td><td><p>4</p></td><td><p><strong>WordArt 垂直</strong>（单个字符竖排，行从左到右）</p></td></tr><tr><td><p>eaVert</p></td><td><p>5</p></td><td><p><strong>东亚垂直</strong>（中文/日文/韩文传统竖排，从上到下，行从右到左）</p></td></tr><tr><td><p>mongolianVert</p></td><td><p>6</p></td><td><p><strong>蒙古文垂直</strong>（特殊竖排规则，文字旋转 90°）</p></td></tr><tr><td><p>wordArtVertRtl</p></td><td><p>7</p></td><td><p><strong>WordArt 垂直（从右到左）</strong>（类似 wordArtVert，但行方向相反）</p></td></tr></table>

## slide-sdk

### sdkData表现

可以看到竖排由bodyPr.vert属性控制，且vert枚举值为**5 = eaVert**，对应**东亚垂直**。

![](/static/img/posts/2026-01-22/doc-img-3.png)

![](/static/img/posts/2026-01-22/doc-img-4.png)

# 渲染解析

## UIData

	对应的uiData为**textDirection，如下。**

![](/static/img/posts/2026-01-22/doc-img-5.png)

**转化函数如下**

canvas渲染时对应的枚举，明显看得出来于文本垂直排版方式枚举对应。

## 渲染实现

### workbench配置

	主要是controller与MENU_SCHEMA的配置。特别注意菜单栏的层级层级关系也配置在此。

![](/static/img/posts/2026-01-22/doc-img-6.png)

![](/static/img/posts/2026-01-22/doc-img-7.png)

### 竖排属性配置

	设置isVertical标识判断，通过插入时设置textBodyStyle.wrapperStyle.textDirection === eaVert 去设置竖排效果。

![](/static/img/posts/2026-01-22/doc-img-8.png)

### 渲染差异

目前的竖排渲染与office有点区别，主要在数字渲染上，如下。

- 腾讯文档竖排时 数字的渲染会旋转90度，且每一排最多只能显示一个数字

![](/static/img/posts/2026-01-22/doc-img-9.png)

- office会和字符一样正常渲染，且每一排最多可显示二个数字

**
![](/static/img/posts/2026-01-22/doc-img-10.png)
**

**	**

#### 分析

	发现是office的bug；如下图：将数字识别为中文了；且伴随光标显示有误

![](/static/img/posts/2026-01-22/doc-img-11.png)

![](/static/img/posts/2026-01-22/doc-img-12.png)

删掉kumimoji =1 标识后显示正常；目前此属性腾讯文档暂未实现--原因在于此属性会导致竖排时数字光标的逻辑和显示异常，暂忽略。

![](/static/img/posts/2026-01-22/doc-img-13.png)

##### 1. 核心属性 kumimoji

<table class="doc-table"><tr><td><p><strong>属性名</strong></p></td><td><p><strong>取值</strong></p></td><td><p><strong>默认值</strong></p></td><td><p><strong>作用</strong></p></td><td><p><strong>适用场景</strong></p></td></tr><tr><td><p><strong>kumimoji</strong></p></td><td><p>0</p></td><td><p>0</p></td><td><p>禁用连字效果，文本按普通方式显示。</p></td><td><p>普通西文或无需连字的东亚文本</p></td></tr><tr><td></td><td><p>1</p></td><td></td><td><p>启用连字效果（如日文“くみ文字”），优化相邻字符的组合显示。</p></td><td><p>日文排版、繁体中文竖排或其他密集文本</p></td></tr></table>

##### 2. 关联 XML 节点与属性

<table class="doc-table"><tr><td><p><strong>XML 节点或属性</strong></p></td><td><p><strong>类型</strong></p></td><td><p><strong>描述</strong></p></td><td><p><strong>与 </strong>kumimoji<strong> 的关联性</strong></p></td></tr><tr><td><p><strong>&lt;a:rPr&gt;</strong></p></td><td><p>节点</p></td><td><p>定义文本运行的格式属性（如字体、语言、连字）。</p></td><td><p>直接包含 kumimoji 属性。</p></td></tr><tr><td><p><strong>lang="en-US"</strong></p></td><td><p>属性</p></td><td><p>指定文本语言（如 en-US 英语，ja-JP 日语）。</p></td><td><p>日文语言下 kumimoji="1" 效果更显著。</p></td></tr><tr><td><p><strong>vert="eaVert"</strong></p></td><td><p>属性</p></td><td><p>设置文本垂直排列（竖排），常见于东亚语言。</p></td><td><p>竖排时连字可能影响行内对齐。</p></td></tr><tr><td><p><strong>&lt;a:spAutoFit/&gt;</strong></p></td><td><p>节点</p></td><td><p>启用文本自动缩放以适应文本框。</p></td><td><p>若连字导致文本过长，可能触发自动缩放。</p></td></tr><tr><td><p><strong>&lt;a:t&gt;...&lt;/a:t&gt;</strong></p></td><td><p>节点</p></td><td><p>包含实际文本内容（如 1222222s）。</p></td><td><p>kumimoji 对其中字符生效（尤其是日文）。</p></td></tr></table>

##### 3. 效果对比示例

<table class="doc-table"><tr><td><p>kumimoji<strong> 值</strong></p></td><td><p><strong>原始文本</strong></p></td><td><p><strong>可能的显示效果（依赖字体）</strong></p></td><td><p><strong>说明</strong></p></td></tr><tr><td><p>0</p></td><td><p>はゝ</p></td><td><p>はゝ （普通分离显示）</p></td><td><p>无连字，字符独立。</p></td></tr><tr><td><p>1</p></td><td><p>はゝ</p></td><td><p>はゝ （可能连字为更紧凑形式）</p></td><td><p>字体支持时会优化组合显示。</p></td></tr><tr><td><p>0</p></td><td><p>ffi</p></td><td><p>ffi （普通英文连字）</p></td><td><p>西文连字由字体控制，与此属性无关。</p></td></tr><tr><td><p>1</p></td><td><p>ffi</p></td><td><p>ﬀi （部分东亚字体可能尝试连字）</p></td><td><p>效果不保证，依赖字体设计。</p></td></tr></table>

##### 4. 重要注意事项

<table class="doc-table"><tr><td><p><strong>项目</strong></p></td><td><p><strong>说明</strong></p></td></tr><tr><td><p><strong>字体依赖</strong></p></td><td><p>必须使用支持连字的字体（如日文字体 MS Gothic/明朝）。</p></td></tr><tr><td><p><strong>语言标记</strong></p></td><td><p>结合 lang="ja-JP" 可增强效果（纯英文文本可能无变化）。</p></td></tr><tr><td><p><strong>动态修改</strong></p></td><td><p>通过 PowerPoint 开发者工具或直接编辑 XML 可调整此属性。</p></td></tr><tr><td><p><strong>竖排兼容性</strong></p></td><td><p>竖排模式（vert="eaVert"）下连字可能失效，需测试目标字体。</p></td></tr></table>